<?php

/**
 * @file
 * TODO Auto generated file, add description.
 */

/**
 * Implements hook_theme().
 *
 */
function veldeke_tools_theme() {
  $theme = array();

  $theme['homepage'] = array(
      'variables' => array(
          'banners_list' => NULL,
          'fixy' => NULL,
          'eiffage_logo' => NULL,
          'brochure_info' => NULL,
      ),
  );

  $theme['contact_page'] = array(
      'variables' => array(
          'contact_details' => NULL,
          'contact_form' => NULL,
          'info_label' => NULL,
      ),
  );

  $theme['composition_page'] = array(
      'variables' => array(
          'name' => NULL,
          'stubs' => NULL,
      ),
  );

  $theme['definition_list'] = array(
      'variables' => array(
          'title' => NULL,
          'items' => NULL,
//          'table' => NULL,
//          'pager' => NULL,
      ),
  );

  $theme['property_detail_page'] = array(
      'variables' => array(
          'building_nav' => NULL,
          'code' => NULL,
          'floor' => NULL,
          'details' => NULL,
          'symbols' => NULL,
          'contact_us_link' => NULL,
          'download_plan_link' => NULL,
          'building_img' => NULL,
          'floor_img' => NULL,
          'property_img' => NULL,
      ),
      'template' => 'property',
  );

  $theme['contact_details'] = array(
      'variables' => array(
          'mode' => 'complete',
          'name' => NULL,
          'info_label' => NULL,
          'address' => NULL,
          'country' => NULL,
          'zip' => NULL,
          'city' => NULL,
          'phone' => NULL,
          'phone_label' => NULL,
          'mail' => NULL,
          'mail_label' => NULL,
          'fax_label' => NULL,
          'fax' => NULL,
      ),
  );
  $theme['site_menu'] = array(
      'variables' => array(
          'items' => NULL,
      ),
  );
  return $theme;
}

function theme_composition_page($variables) {
  $output = '';
  //dpm($variables);
  foreach ($variables['stubs'] as $stub) {
    $output .= "<section class='{$stub['name']}'>{$stub['html']}</section>";
  }
  return $output;
}

/**
 * TODO Autogenerated function.
 */
function veldeke_tools_preprocess_project_page(&$variables) {
  //dpm($variables);
}

/**
 * TODO Autogenerated function.
 */
function veldeke_tools_preprocess_maison_veldeke_page(&$variables) {
  //dpm($variables);
}

/**
 * Returns (in some cases) valid hcard HTML for contact details 
 * (address, email etc) . hcard markup http://microformats.org/wiki/hcard
 *
 * @param $variables
 *   An associative array containing:
 *   - name: name of the contact person
 *   - mode:
 *   - name:
 *   - address:
 *   - country:
 *   - zip:
 *   - city:
 *   - phone:
 *   - phone_label:
 *   - mail:
 *   - mail_label:
 *   - fax_label:
 *   - fax:
 * 
 * @ingroup themeable
 */
function theme_contact_details(&$vars) {
  $output = '';
  //$scrambled_mail = veldeke_tools_hide_email($vars['mail']);
  $scrambled_mail = $vars['mail'];
  $mail = l($scrambled_mail, 'mailto:' . $scrambled_mail, array('absolute' => TRUE, 'html' => true, 'attributes' => array('class' => array('email'))));
  $logo = l($vars['logo'], '', array('html' => true));
//  $tel = "<a class='tellink tel' href='tel:{$vars['phone']}'>{$vars['phone']}</a>";
  $tel = l($vars['phone'], 'tel:' . $vars['phone'], array('attributes' => array('class' => array('tellink', 'tel'))));

  switch ($vars['mode']) {

    case 'concise':
      $output .= "<address class='vcard'><strong><i class='icon-tel'></i><span>{$tel}</span></strong><span class='email'><i class='icon-mail'></i>{$mail}</span></address>";
      break;

    case 'medium':
      $output .= "<address class='vcard'><strong>{$tel}</strong><br>{$mail}</address><figure>{$logo}</figure>";
      break;

    case 'large':
      $output = "<div class='address'>
    <i class='icon-map'></i>
    <h2>{$vars['info_label']}</h2>
    <p class='adr'><span class='street-address'>{$vars['address']}</span><br /><span class='postal-code'>{$vars['zip']}</span><span class='locality'>{$vars['city']}</span></p>
  </div>
  <address>
    <i class='icon-info'></i><p>{$tel}<br>{$mail}</p>
  </address>";
      break;

    case 'complete':

    default:
      $output .= "<address class='vcard'>
       <div class='adr'>
        <span class='street-address'>{$vars['address']}</span> | 
        <span class='postal-code'>{$vars['zip']}</span>
        <span class='locality'>{$vars['city']}</span>
       </div>    
       <div class='tel'>{$vars['phone']}</div>
       <div><a class='email' href='mailto:{$vars['mail']}'>{$vars['mail']}</a></div>
      </address>";
      break;
  }
  return $output;
}

/**
 * TODO Autogenerated function.
 */
function veldeke_tools_preprocess_contact_details(&$variables) {
//  dpm($variables);
}

function theme_homepage(&$vars) {
  $output = '';
//  dpm($vars);
  $output .= "<div class='main-banner'>
                <div class='rotator'>{$vars['banners_list']}</div><!-- no-white space
                --><div class='fixy'>{$vars['fixy']}</div>
              </div>
              <div class='advert clearfix'>
                <div class='brochure clearfix'>{$vars['brochure_info']}</div>
                {$vars['eiffage_logo']}
              </div>";
  return $output;
}

function theme_contact_page(&$vars) {
  $output = '';
  $output .= "<section class='resume'>{$vars['contact_details']}</section>";
  $output .= "<div class='webform'>${vars['contact_form']}</div>";
  return $output;
}

/**
 * TODO Autogenerated function.
 */
function veldeke_tools_preprocess_contact_page(&$variables) {
//  dpm($variables);
}

function theme_properties_page(&$vars) {
  $output = '';
  $output .= $vars['building_nav'];
  $output .= "<div class='filter'>{$vars['filter']}</div>";
  $output .= $vars['table'];
  $output .= $vars['pager'];
  return $output;
}

function theme_site_menu(&$vars) {
  $output = '<nav role="navigation">';
  $output .= '<span class="nav-toggle"></span>';
  $output .= theme('item_list', array('items' => $vars['items'], 'type' => 'ul', 'attributes' => array()));
  $output .= '</nav>';
  return $output;
}

function theme_definition_list(&$vars) {
  $title = $vars['title'];
  $items = $vars['items'];
  $output = '<div class="definition-list">';
  if (isset($title)) {
    $output .= '<h3>' . ($filter ? check_plain($title) : $title) . '</h3>';
  }

  if (!empty($items)) {
    $output .= "<dl>";
    foreach ($items as $item) {
      if (is_string($item['term'])) {
        $output .= '  <dt>' . ($filter ? check_plain($item['term']) : $item['term']) . '</dt>';
      } elseif (is_array($item['term'])) {
        foreach ($item['term'] as $term) {
          $output .= '  <dt>' . ($filter ? check_plain($term) : $term) . "</dt>\n";
        }
      }

      if (is_string($item['definitions'])) {
        $output .= '  <dd>' . ($filter ? filter_xss($item['definitions']) : $item['definitions']) . '</dd>';
      } elseif (is_array($item['definitions'])) {
        foreach ($item['definitions'] as $definition) {
          $output .= '  <dd>' . ($filter ? filter_xss($definition) : $definition) . "</dd>\n";
        }
      }
    }
    $output .= "</dl>";
  }
  $output .= '</div>';
  return $output;
}